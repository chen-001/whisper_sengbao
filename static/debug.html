<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¼•ç”¨åŠŸèƒ½è°ƒè¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-message {
            background: #fff;
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            border: 1px solid #ddd;
            cursor: pointer;
            user-select: none;
        }
        .test-message:hover {
            background: #f0f8ff;
        }
        .context-menu {
            position: fixed;
            background: white;
            border: 1px solid #ccc;
            border-radius: 5px;
            padding: 5px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: none;
            z-index: 1000;
        }
        .context-menu-item {
            padding: 8px 15px;
            cursor: pointer;
        }
        .context-menu-item:hover {
            background: #f0f0f0;
        }
        .log {
            background: #000;
            color: #0f0;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>å¼•ç”¨åŠŸèƒ½è°ƒè¯•æµ‹è¯•</h1>
    <p>è¯·å°è¯•ä»¥ä¸‹æ“ä½œï¼š</p>
    <ul>
        <li>å³é”®ç‚¹å‡»ä¸‹é¢çš„æ¶ˆæ¯</li>
        <li>é•¿æŒ‰æ¶ˆæ¯ï¼ˆ500msï¼‰</li>
        <li>åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šé•¿æŒ‰æ¶ˆæ¯</li>
    </ul>

    <div class="test-message" data-username="æµ‹è¯•ç”¨æˆ·1" data-message="è¿™æ˜¯ç¬¬ä¸€æ¡æµ‹è¯•æ¶ˆæ¯">
        <strong>æµ‹è¯•ç”¨æˆ·1:</strong> è¿™æ˜¯ç¬¬ä¸€æ¡æµ‹è¯•æ¶ˆæ¯
    </div>

    <div class="test-message" data-username="æµ‹è¯•ç”¨æˆ·2" data-message="è¿™æ˜¯ç¬¬äºŒæ¡æµ‹è¯•æ¶ˆæ¯ï¼Œç”¨æ¥æµ‹è¯•å¼•ç”¨åŠŸèƒ½">
        <strong>æµ‹è¯•ç”¨æˆ·2:</strong> è¿™æ˜¯ç¬¬äºŒæ¡æµ‹è¯•æ¶ˆæ¯ï¼Œç”¨æ¥æµ‹è¯•å¼•ç”¨åŠŸèƒ½
    </div>

    <div class="context-menu" id="contextMenu">
        <div class="context-menu-item" data-action="quote">ğŸ’¬ å¼•ç”¨æ¶ˆæ¯</div>
        <div class="context-menu-item" data-action="more">âš™ï¸ æ›´å¤šé€‰é¡¹</div>
    </div>

    <div class="log" id="log">
        <div>è°ƒè¯•æ—¥å¿—å°†åœ¨è¿™é‡Œæ˜¾ç¤º...</div>
    </div>

    <script>
        const log = document.getElementById('log');
        const contextMenu = document.getElementById('contextMenu');
        let selectedMessage = null;
        let longPressTimer = null;

        function addLog(message) {
            const div = document.createElement('div');
            div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            log.appendChild(div);
            log.scrollTop = log.scrollHeight;
        }

        function showContextMenu(event, messageEl) {
            addLog(`æ˜¾ç¤ºä¸Šä¸‹æ–‡èœå• - æ¶ˆæ¯: ${messageEl.dataset.message}`);
            
            selectedMessage = {
                username: messageEl.dataset.username,
                message: messageEl.dataset.message,
                element: messageEl
            };

            contextMenu.style.display = 'block';
            
            let x, y;
            if (event.touches && event.touches.length > 0) {
                x = event.touches[0].clientX;
                y = event.touches[0].clientY;
            } else {
                x = event.clientX;
                y = event.clientY;
            }

            contextMenu.style.left = x + 'px';
            contextMenu.style.top = y + 'px';
            addLog(`èœå•ä½ç½®: ${x}, ${y}`);
        }

        function hideContextMenu() {
            contextMenu.style.display = 'none';
            selectedMessage = null;
            addLog('éšè—ä¸Šä¸‹æ–‡èœå•');
        }

        function handleQuote() {
            if (!selectedMessage) {
                addLog('é”™è¯¯: æ²¡æœ‰é€‰ä¸­çš„æ¶ˆæ¯');
                return;
            }
            addLog(`å¼•ç”¨æ¶ˆæ¯: ${selectedMessage.username} - ${selectedMessage.message}`);
            alert(`å¼•ç”¨æˆåŠŸ!\nç”¨æˆ·: ${selectedMessage.username}\næ¶ˆæ¯: ${selectedMessage.message}`);
        }

        // ç»‘å®šäº‹ä»¶
        document.querySelectorAll('.test-message').forEach(messageEl => {
            // å³é”®ç‚¹å‡»
            messageEl.addEventListener('contextmenu', (e) => {
                e.preventDefault();
                addLog('å³é”®ç‚¹å‡»äº‹ä»¶è§¦å‘');
                showContextMenu(e, messageEl);
            });

            // é•¿æŒ‰äº‹ä»¶
            messageEl.addEventListener('mousedown', (e) => {
                if (e.button === 0) {
                    addLog('å¼€å§‹é•¿æŒ‰è®¡æ—¶');
                    longPressTimer = setTimeout(() => {
                        addLog('é•¿æŒ‰è§¦å‘');
                        showContextMenu(e, messageEl);
                    }, 500);
                }
            });

            messageEl.addEventListener('mouseup', () => {
                if (longPressTimer) {
                    clearTimeout(longPressTimer);
                    longPressTimer = null;
                    addLog('å–æ¶ˆé•¿æŒ‰è®¡æ—¶');
                }
            });

            // ç§»åŠ¨ç«¯
            messageEl.addEventListener('touchstart', (e) => {
                addLog('è§¦æ‘¸å¼€å§‹');
                longPressTimer = setTimeout(() => {
                    addLog('ç§»åŠ¨ç«¯é•¿æŒ‰è§¦å‘');
                    showContextMenu(e, messageEl);
                }, 500);
            });

            messageEl.addEventListener('touchend', (e) => {
                if (longPressTimer) {
                    clearTimeout(longPressTimer);
                    longPressTimer = null;
                    addLog('è§¦æ‘¸ç»“æŸï¼Œå–æ¶ˆé•¿æŒ‰');
                }
            });
        });

        // ä¸Šä¸‹æ–‡èœå•äº‹ä»¶
        contextMenu.addEventListener('click', (e) => {
            e.stopPropagation();
            const menuItem = e.target.closest('.context-menu-item');
            if (menuItem) {
                const action = menuItem.dataset.action;
                addLog(`èœå•é¡¹ç‚¹å‡»: ${action}`);
                if (action === 'quote') {
                    handleQuote();
                }
                hideContextMenu();
            }
        });

        // ç‚¹å‡»å…¶ä»–åœ°æ–¹éšè—èœå•
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.context-menu')) {
                hideContextMenu();
            }
        });

        addLog('è°ƒè¯•é¡µé¢åˆå§‹åŒ–å®Œæˆ');
    </script>
</body>
</html> 